<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>WildPx Model Release</title>
<style>
  :root { --ok:#22c55e; --err:#ef4444; }
  *{box-sizing:border-box}
  body{margin:0;font-family:Segoe UI,Tahoma,Arial,sans-serif;color:#fff;background:url('BackgroundImage.png') center/cover fixed no-repeat}
  body::before{content:"";position:fixed;inset:0;background:rgba(0,100,0,.8);z-index:0}
  .overlay{position:relative;z-index:1;background:rgba(0,0,0,.65);max-width:640px;margin:40px auto;padding:20px;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,.4)}
  label,select,input,textarea,button{display:block;width:100%;margin-bottom:12px;font-size:1rem}
  input,select,textarea{padding:8px;border:none;border-radius:4px;background:#fff;color:#111}
  button{background:#5cb85c;color:#fff;font-weight:700;padding:10px;border:none;border-radius:6px;cursor:pointer}
  button:hover{background:#4cae4c}
  .logo{display:block;margin:0 auto 16px;max-width:200px;user-select:none;-webkit-user-drag:none}
  canvas{background:#fff;border:1px solid #ccc;border-radius:4px;display:block;width:100%;height:150px;margin-bottom:10px;touch-action:none}
  #banner{display:none;position:fixed;left:16px;right:16px;top:12px;z-index:9999;padding:12px;border-radius:8px;text-align:center;font-weight:700}
  #banner.ok{background:rgba(34,197,94,.96)}
  #banner.err{background:rgba(239,68,68,.96)}
  #adminBar{display:none;gap:8px;align-items:center;margin:10px 0}
  #adminBar button{flex:0 0 auto}
  small{color:#ddd}
  ul{padding-left:20px}
  ul li{margin-bottom:6px}
</style>
</head>
<body>
  <!-- Confirmation banner -->
  <div id="banner" role="status" aria-live="polite"></div>

  <div class="overlay">
    <img src="WILDPX-01-5-.png" alt="WildPx Logo" class="logo" />

    <!-- Hidden admin bar (long-press logo ~1.2s to toggle) -->
    <div id="adminBar">
      <button type="button" id="exportAllBtn" style="background:#2563eb">Export All</button>
      <button type="button" id="exportClearBtn" style="background:#7c3aed">Export & Clear</button>
      <span id="savedCount" style="font-size:.9rem;opacity:.9">Saved: 0</span>
    </div>

    <h1>Model & Photo Release Form</h1>

    <form id="releaseForm" novalidate>
      <label>Model Full Name:
        <input type="text" name="fullName" required />
      </label>

      <label>Address Line 1:
        <input type="text" name="address1" />
      </label>
      <label>Address Line 2:
        <input type="text" name="address2" />
      </label>
      <label>City:
        <input type="text" name="city" />
      </label>
      <label>State:
        <input type="text" name="state" />
      </label>
      <label>Zip Code:
        <input type="text" name="zip" />
      </label>

      <label>Phone:
        <input type="text" name="phone" />
      </label>
      <label>Email:
        <input type="email" name="email" />
      </label>

      <label>Are you at least 18 years of age?
        <select id="ageCheck" name="ageCheck" required>
          <option value="">Select</option>
          <option value="yes">Yes</option>
          <option value="no">No</option>
        </select>
      </label>

      <div id="childrenSection" style="display:none">
        <h3>Additional Children (if any)</h3>
        <label>Names and ages:<br>
          <small>Example: Jane (7), Sam (5)</small>
          <textarea name="additionalChildren" rows="3" placeholder="Enter names and ages here"></textarea>
        </label>
      </div>

      <div id="guardianSection" style="display:none">
        <h3>Parent/Guardian Info</h3>
        <label>Guardian Name:
          <input type="text" name="guardianName" />
        </label>
        <label>Relationship to Participant:
          <input type="text" name="guardianRelationship" />
        </label>
      </div>

      <label>
        Please take or upload a photo of the participant.<br>
        <small>Tap Upload to open camera or files.</small>
        <input type="file" name="headshot" accept="image/*" capture="user" />
      </label>

      <p><strong>Photo Release & Copyright Agreement</strong></p>
      <p>
        I hereby grant WildPx LLC, its legal representatives, assigns, and licensees the absolute and irrevocable right
        and permission to use, publish, reproduce, modify, or otherwise exploit, in whole or in part, my likeness and
        any photographs or digital images taken of me, in any form, media, or manner, now or hereafter known, for any
        purpose, including advertising, promotion, marketing, editorial, and display. I acknowledge that all copyrights
        in the images are the sole and exclusive property of WildPx LLC, and I waive any right to inspect or approve the
        final images, derivatives, or uses thereof. I further agree that I shall not reproduce, distribute, alter, edit,
        or otherwise use any of the images without prior written consent from WildPx LLC.
      </p>

      <ul>
        <li>All image copyrights belong to WildPx LLC.</li>
        <li>No compensation unless agreed in writing.</li>
        <li>Images may be edited, retouched, or modified.</li>
        <li>I waive any right to review or approve final uses.</li>
        <li>I will not reproduce or edit images without written permission.</li>
      </ul>

      <!-- ONE shared signature area that flips label -->
      <label><span id="signatureLabel">Model Signature:</span></label>
      <canvas id="signatureCanvas"></canvas>
      <button type="button" onclick="clearPrimarySig()">Clear Signature</button>
      <input type="hidden" name="modelSignature" id="signatureData" />

      <label>Date:
        <input type="date" name="signatureDate" />
        <small>If left blank, today’s date will be used on submit.</small>
      </label>

      <button type="submit">Submit</button>
    </form>
  </div>

  <!-- Signature Pad -->
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.5/dist/signature_pad.umd.min.js"></script>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    console.log('✅ index.html loaded');
    const KEY = 'formEntries';

    // Elements
    const banner = document.getElementById('banner');
    const form = document.getElementById('releaseForm');
    const ageSelect = document.getElementById('ageCheck');
    const guardianSection = document.getElementById('guardianSection');
    const childrenSection = document.getElementById('childrenSection');
    const signatureLabelEl = document.getElementById('signatureLabel');
    const signatureCanvas = document.getElementById('signatureCanvas');
    const signatureData = document.getElementById('signatureData');
    const signatureDateInput = form.querySelector('input[name="signatureDate"]');

    const exportAllBtn = document.getElementById('exportAllBtn');
    const exportClearBtn = document.getElementById('exportClearBtn');
    const savedCountEl = document.getElementById('savedCount');

    // Banner helpers
    function showBannerOk(msg){
      banner.className = 'ok';
      banner.textContent = msg || 'Saved';
      banner.style.display = 'block';
      setTimeout(() => banner.style.display = 'none', 4000);
    }
    function showBannerErr(msg){
      banner.className = 'err';
      banner.textContent = msg || 'Error';
      banner.style.display = 'block';
      setTimeout(() => banner.style.display = 'none', 5000);
    }

    // Signature pad (single)
    let primaryPad = null;
    function resizeCanvas(canvas, pad) {
      const ratio = Math.max(window.devicePixelRatio || 1, 1);
      const rect = canvas.getBoundingClientRect();
      if (!rect.width) return;
      canvas.width  = Math.floor(rect.width * ratio);
      canvas.height = Math.floor(150 * ratio);
      const ctx = canvas.getContext('2d');
      ctx.scale(ratio, ratio);
      pad?.clear?.();
    }
    function initPrimaryPad() {
      if (!window.SignaturePad) { console.error('SignaturePad not loaded'); return; }
      if (!primaryPad) primaryPad = new window.SignaturePad(signatureCanvas, { penColor: '#000' });
      requestAnimationFrame(() => resizeCanvas(signatureCanvas, primaryPad));
    }
    window.clearPrimarySig = () => { primaryPad?.clear(); };
    initPrimaryPad();
    window.addEventListener('resize', () => { if (primaryPad) requestAnimationFrame(() => resizeCanvas(signatureCanvas, primaryPad)); });

    // Age toggle
    function updateMinorUI() {
      const isMinor = String(ageSelect.value || '').toLowerCase() === 'no';
      guardianSection.style.display = isMinor ? 'block' : 'none';
      childrenSection.style.display = isMinor ? 'block' : 'none';

      const gName = form.querySelector('input[name="guardianName"]');
      const gRel  = form.querySelector('input[name="guardianRelationship"]');
      if (gName) gName.required = isMinor;
      if (gRel)  gRel.required  = isMinor;

      signatureLabelEl.textContent = isMinor ? 'Parent/Guardian Signature:' : 'Model Signature:';
    }
    ageSelect.addEventListener('change', updateMinorUI);
    ageSelect.addEventListener('input',  updateMinorUI);
    updateMinorUI();

    // Local storage helpers
    function getAll(){ try { return JSON.parse(localStorage.getItem(KEY) || '[]'); } catch { return []; } }
    function setAll(arr){ localStorage.setItem(KEY, JSON.stringify(arr)); updateSavedCount(); }
    function updateSavedCount(){ const n = getAll().length; if (savedCountEl) savedCountEl.textContent = 'Saved: ' + n; }
    updateSavedCount();

    function setTodayIfBlank(){
      if (!signatureDateInput.value) signatureDateInput.value = new Date().toISOString().slice(0,10);
    }
    function fileToDataURL(file){
      return new Promise((resolve, reject) => {
        const r = new FileReader();
        r.onload = () => resolve(r.result);
        r.onerror = () => reject(r.error);
        r.readAsDataURL(file);
      });
    }

    // Submit (local save only)
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      const fullName = (form.elements['fullName'].value || '').trim();
      const ageVal = String(ageSelect.value || '').toLowerCase();
      const isMinor = ageVal === 'no';

      if (!fullName) { showBannerErr('Please enter the model’s full name.'); return; }
      if (!ageVal)   { showBannerErr('Please select Yes/No for age.'); return; }
      if (!primaryPad || primaryPad.isEmpty()) {
        showBannerErr(isMinor ? 'Please have the Parent/Guardian sign.' : 'Please sign as the model.');
        return;
      }
      if (isMinor) {
        const gName = (form.elements['guardianName'].value || '').trim();
        const gRel  = (form.elements['guardianRelationship'].value || '').trim();
        if (!gName || !gRel) { showBannerErr('Guardian Name and Relationship are required.'); return; }
      }

      setTodayIfBlank();

      // capture signature into hidden field
      signatureData.value = primaryPad.toDataURL('image/jpeg', 0.85);

      const fd = new FormData(form);
      const data = Object.fromEntries(fd.entries());
      data.timestamp = new Date().toISOString();

      // Optional: include headshot if small
      const file = form.elements['headshot']?.files?.[0];
      if (file) {
        try {
          if (file.size <= 300000) {
            data.headshotDataURL = await fileToDataURL(file);
          } else {
            data.headshotNote = 'Headshot present but large; not saved inline (' + file.size + ' bytes)';
          }
        } catch { data.headshotNote = 'Headshot present but could not be read'; }
      }

      try {
        const all = getAll();
        all.push(data);
        setAll(all);
      } catch {
        showBannerErr('Could not save locally. Check browser settings.');
        return;
      }

      form.reset();
      primaryPad?.clear();
      updateMinorUI();
      window.scrollTo({ top: 0, behavior: 'smooth' });

      showBannerOk('Saved locally. Total: ' + getAll().length);
    }, { capture:true });

    // Hidden admin bar: long-press logo
    (function setupAdminReveal(){
      const logo = document.querySelector('.logo');
      const adminBar = document.getElementById('adminBar');
      if (!logo || !adminBar) return;

      let t = null;
      const start = () => { t = setTimeout(() => {
        adminBar.style.display = (adminBar.style.display === 'none' || !adminBar.style.display) ? 'flex' : 'none';
      }, 1200); };
      const cancel = () => { if (t) clearTimeout(t); };

      logo.addEventListener('mousedown', start);
      logo.addEventListener('touchstart', start, {passive:true});
      ['mouseup','mouseleave','touchend','touchcancel'].forEach(ev => logo.addEventListener(ev, cancel));
    })();

    // Export helpers
    function downloadJSON(filename, obj) {
      const blob = new Blob([JSON.stringify(obj, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = filename;
      document.body.appendChild(a); a.click(); a.remove();
      setTimeout(() => URL.revokeObjectURL(url), 500);
    }

    // Export all
    exportAllBtn.addEventListener('click', () => {
      const entries = getAll();
      if (!entries.length) { showBannerErr('No saved forms to export.'); return; }
      const bundle = { exported_at: new Date().toISOString(), count: entries.length, entries };
      const fn = 'wildpx_releases_' + new Date().toISOString().slice(0,10) + '_n' + entries.length + '.json';
      downloadJSON(fn, bundle);
      showBannerOk('Exported ' + entries.length + ' forms.');
    });

    // Export & clear
    exportClearBtn.addEventListener('click', () => {
      const entries = getAll();
      if (!entries.length) { showBannerErr('Nothing to export.'); return; }
      if (!confirm('Export all forms and then clear them from this device?')) return;

      const bundle = { exported_at: new Date().toISOString(), count: entries.length, entries };
      const fn = 'wildpx_releases_' + new Date().toISOString().slice(0,10) + '_n' + entries.length + '.json';
      downloadJSON(fn, bundle);

      localStorage.removeItem(KEY);
      updateSavedCount();
      showBannerOk('Exported and cleared.');
    });
  });
  </script>
</body>
</html>
