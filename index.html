<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>WildPx Model Release</title>
  <!-- PWA setup -->
<link rel="manifest" href="/ModelReleaseForm/manifest.webmanifest">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<style>
  :root { --ok:#22c55e; --err:#ef4444; }
  *{box-sizing:border-box}
  body{margin:0;font-family:Segoe UI,Tahoma,Arial,sans-serif;color:#fff;background:url('BackgroundImage.png') center/cover fixed no-repeat}
  body::before{content:"";position:fixed;inset:0;background:rgba(0,100,0,.8);z-index:0}
  .overlay{position:relative;z-index:1;background:rgba(0,0,0,.65);max-width:640px;margin:40px auto;padding:20px;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,.4)}
  label,select,input,textarea,button{display:block;width:100%;margin-bottom:12px;font-size:1rem}
  input,select,textarea{padding:8px;border:none;border-radius:4px;background:#fff;color:#111}
  button{background:#5cb85c;color:#fff;font-weight:700;padding:10px;border:none;border-radius:6px;cursor:pointer}
  button:hover{background:#4cae4c}
  .logo{display:block;margin:0 auto 16px;max-width:200px;user-select:none;-webkit-user-drag:none}
  canvas{background:#fff;border:1px solid #ccc;border-radius:4px;display:block;width:100%;height:150px;margin-bottom:10px;touch-action:none}
  #banner{display:none;position:fixed;left:16px;right:16px;top:12px;z-index:9999;padding:12px;border-radius:8px;text-align:center;font-weight:700}
  #banner.ok{background:rgba(34,197,94,.96)}
  #banner.err{background:rgba(239,68,68,.96)}
  #adminBar{display:none;gap:8px;align-items:center;margin:10px 0}
  #adminBar button{flex:0 0 auto}
  small{color:#ddd}
  ul{padding-left:20px}
  ul li{margin-bottom:6px}
</style>
</head>
<body>
  <!-- Confirmation banner -->
  <div id="banner" role="status" aria-live="polite"></div>

  <div class="overlay">
      <img src="WILDPX-01-5.png" alt="WildPx Logo" class="logo">

    <!-- Hidden admin bar (long-press logo ~1.2s to toggle) -->
    <div id="adminBar">
      <button type="button" id="exportAllBtn" style="background:#2563eb">Export All</button>
      <button type="button" id="exportClearBtn" style="background:#7c3aed">Export & Clear</button>  
<button type="button" id="printPdfBtn"   style="background:#f59e0b">Print / Save PDF</button>

      <span id="savedCount" style="font-size:.9rem;opacity:.9">Saved: 0</span>
    </div>

    <h1>Model & Photo Release Form</h1>

    <form id="releaseForm" novalidate>
      <label>Model Full Name:
        <input type="text" name="fullName" required />
      </label>

      <label>Address Line 1:
        <input type="text" name="address1" />
      </label>
      <label>Address Line 2:
        <input type="text" name="address2" />
      </label>
      <label>City:
        <input type="text" name="city" />
      </label>
      <label>State:
        <input type="text" name="state" />
      </label>
      <label>Zip Code:
        <input type="text" name="zip" />
      </label>

      <label>Phone:
        <input type="text" name="phone" />
      </label>
      <label>Email:
        <input type="email" name="email" />
      </label>

      <label>Are you at least 18 years of age?
        <select id="ageCheck" name="ageCheck" required>
          <option value="">Select</option>
          <option value="yes">Yes</option>
          <option value="no">No</option>
        </select>
      </label>

      <div id="childrenSection" style="display:none">
        <h3>Additional Children (if any)</h3>
        <label>Names and ages:<br>
          <small>Example: Jane (7), Sam (5)</small>
          <textarea name="additionalChildren" rows="3" placeholder="Enter names and ages here"></textarea>
        </label>
      </div>

      <div id="guardianSection" style="display:none">
        <h3>Parent/Guardian Info</h3>
        <label>Guardian Name:
          <input type="text" name="guardianName" />
        </label>
        <label>Relationship to Participant:
          <input type="text" name="guardianRelationship" />
        </label>
      </div>

      <label>
        Please take or upload a photo of the participant.<br>
        <small>Tap Upload to open camera or files.</small>
        <input type="file" id="headshot" name="headshot" accept="image/*" capture="user" />
      </label>

      <p><strong>Photo Release & Copyright Agreement</strong></p>
      <p>
        I hereby grant WildPx LLC, its legal representatives, assigns, and licensees the absolute and irrevocable right
        and permission to use, publish, reproduce, modify, or otherwise exploit, in whole or in part, my likeness and
        any photographs or digital images taken of me, in any form, media, or manner, now or hereafter known, for any
        purpose, including advertising, promotion, marketing, editorial, and display. I acknowledge that all copyrights
        in the images are the sole and exclusive property of WildPx LLC, and I waive any right to inspect or approve the
        final images, derivatives, or uses thereof. I further agree that I shall not reproduce, distribute, alter, edit,
        or otherwise use any of the images without prior written consent from WildPx LLC.
      </p>

      <ul>
        <li>All image copyrights belong to WildPx LLC.</li>
        <li>No compensation unless agreed in writing.</li>
        <li>Images may be edited, retouched, or modified.</li>
        <li>I waive any right to review or approve final uses.</li>
        <li>I will not reproduce or edit images without written permission.</li>
      </ul>

      <!-- ONE shared signature area that flips label -->
      <label><span id="signatureLabel">Model Signature:</span></label>
      <canvas id="signatureCanvas"></canvas>
   <button type="button" id="clearSigBtn" aria-label="Clear signature">Clear Signature</button>
      <input type="hidden" name="modelSignature" id="signatureData" />

      <label>Date:
        <input type="date" name="signatureDate" />
        <small>If left blank, today’s date will be used on submit.</small>
      </label>

      <button type="submit">Submit</button>
       </form>
  </div> <!-- /.overlay -->

  <!-- Signature Pad (library only) -->
 <!-- Signature Pad (library only) -->
<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.5/dist/signature_pad.umd.min.js"></script>

<!-- INLINE app logic (bypass broken external/cached file) -->
<script>
// Kill any stale service worker so the latest code actually runs
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.getRegistrations?.().then(rs => rs.forEach(r => r.unregister())).catch(()=>{});
}

(() => {
  if (window.__WILDPX_LOCK__) return; window.__WILDPX_LOCK__ = true;

  document.addEventListener('DOMContentLoaded', () => {
    // ----- elements (match your HTML) -----
    const banner           = document.getElementById('banner');
    const form             = document.getElementById('releaseForm');

    const ageSelect        = document.getElementById('ageCheck');
    const guardianSection  = document.getElementById('guardianSection');
    const childrenSection  = document.getElementById('childrenSection');

    const signatureLabelEl = document.getElementById('signatureLabel');
    const signatureCanvas  = document.getElementById('signatureCanvas');
    const signatureData    = document.getElementById('signatureData');
    const clearBtn         = document.getElementById('clearSigBtn');
    const signatureDateInp = form?.querySelector('input[name="signatureDate"]');

    const exportAllBtn     = document.getElementById('exportAllBtn');
    const exportClearBtn   = document.getElementById('exportClearBtn');
    const exportCsvBtn     = document.getElementById('exportCsvBtn');
    const printPdfBtn      = document.getElementById('printPdfBtn');
    const savedCountEl     = document.getElementById('savedCount');

    const logo             = document.querySelector('.logo');
    const adminBar         = document.getElementById('adminBar');

    // ----- small helpers -----
    const KEY = 'formEntries';
    const getAll = () => { try { return JSON.parse(localStorage.getItem(KEY)||'[]'); } catch { return []; } };
    const setAll = (arr) => { localStorage.setItem(KEY, JSON.stringify(arr)); updateSavedCount(); };
    function updateSavedCount(){ if (savedCountEl) savedCountEl.textContent = 'Saved: ' + getAll().length; }
    function toast(kind, msg){ if (!banner) return; banner.className=kind; banner.textContent=msg|| (kind==='ok'?'Saved':'Error'); banner.style.display='block'; setTimeout(()=>banner.style.display='none', kind==='ok'?3000:4500); }
    const ok=(m)=>toast('ok',m), err=(m)=>toast('err',m);
    updateSavedCount();

    // ===== signature pad (single canvas) =====
    if (signatureCanvas) {
      signatureCanvas.style.touchAction = 'none';
      if (!signatureCanvas.style.height) signatureCanvas.style.height = '150px';
    }

    let pad=null, lastCssW=0;
    function resizeCanvasPreserve(canvas, pad){
      if (!canvas) return;
      const rect=canvas.getBoundingClientRect();
      const cssW=Math.floor(rect.width); if (!cssW) return;
      if (cssW===lastCssW && pad && !pad.isEmpty()) return;
      lastCssW=cssW;
      const ratio=Math.max(window.devicePixelRatio||1,1);
      const data=(pad && !pad.isEmpty()) ? pad.toData() : null;
      const cssH = Math.floor(parseFloat(getComputedStyle(canvas).height) || 150);
      canvas.width=Math.floor(cssW*ratio); canvas.height=Math.floor(cssH*ratio);
      const ctx=canvas.getContext('2d'); ctx.setTransform(ratio,0,0,ratio,0,0);
      if (pad){ pad.clear(); if (data && data.length) pad.fromData(data); }
    }
    function scheduleResize(){ if (scheduleResize._id) return; scheduleResize._id=requestAnimationFrame(()=>{ scheduleResize._id=null; resizeCanvasPreserve(signatureCanvas,pad); }); }
    function updateClearState(){ if (clearBtn) clearBtn.disabled = !pad || pad.isEmpty(); }

    function initPad(){
      if (!signatureCanvas) return;
      if (!window.SignaturePad){ err('Signature pad library missing.'); return; }
      if (!pad){
        pad = new window.SignaturePad(signatureCanvas, { penColor:'#000' });
        pad.onEnd = updateClearState;
        requestAnimationFrame(()=>resizeCanvasPreserve(signatureCanvas, pad));
        updateClearState();
      }
    }
    clearBtn?.addEventListener('click', (e)=>{ if (!pad || pad.isEmpty()) return; e.preventDefault(); if (confirm('Clear signature?')){ pad.clear(); updateClearState(); }});
    initPad();
    window.addEventListener('resize', scheduleResize);
    window.addEventListener('orientationchange', ()=>setTimeout(scheduleResize,300));
    window.addEventListener('pageshow', scheduleResize, { once:true });

    // ===== age reveal (yes/no) =====
    const isMinor = () => String(ageSelect?.value||'').trim().toLowerCase()==='no';
    function updateMinorUI(){
      const minor=isMinor();
      if (guardianSection) guardianSection.style.display = minor?'block':'none';
      if (childrenSection) childrenSection.style.display = minor?'block':'none';
      const gName=form?.elements['guardianName'], gRel=form?.elements['guardianRelationship'];
      if (gName) gName.required=minor; if (gRel) gRel.required=minor;
      if (signatureLabelEl) signatureLabelEl.textContent = minor ? 'Parent/Guardian Signature:' : 'Model Signature:';
      scheduleResize();
    }
    ageSelect?.addEventListener('change', updateMinorUI);
    ageSelect?.addEventListener('input',  updateMinorUI);
    form?.addEventListener('input', (e)=>{ if (e.target===ageSelect) updateMinorUI(); });
    document.addEventListener('visibilitychange', ()=>{ if (!document.hidden) updateMinorUI(); });
    updateMinorUI();

    // ===== submit (local save only) =====
    function setTodayIfBlank(){ if (signatureDateInp && !signatureDateInp.value){ signatureDateInp.value=new Date().toISOString().slice(0,10); } }
    form?.addEventListener('submit', (e)=>{
      e.preventDefault();
      const fullName=(form.elements['fullName']?.value || '').trim();
      if (!fullName){ err('Please enter the model’s full name.'); return; }
      if (!ageSelect?.value){ err('Please select Yes/No for age.'); return; }
      const minor=isMinor();
      if (!pad || pad.isEmpty()){ err(minor?'Please have the Parent/Guardian sign.':'Please sign as the model.'); return; }
      if (minor){
        const gName=(form.elements['guardianName']?.value||'').trim();
        const gRel =(form.elements['guardianRelationship']?.value||'').trim();
        if (!gName || !gRel){ err('Guardian Name and Relationship are required.'); return; }
      }
      setTodayIfBlank();
      if (signatureData && pad) signatureData.value = pad.toDataURL('image/jpeg',0.85);

      const fd=new FormData(form);
      const data=Object.fromEntries(fd.entries());
      data.timestamp=new Date().toISOString();
      try{ const all=getAll(); all.push(data); setAll(all); } catch{ err('Could not save locally.'); return; }

      const holdAge=ageSelect.value;
      form.reset(); ageSelect.value=holdAge;
      pad.clear(); updateMinorUI(); updateClearState();
      window.scrollTo({top:0,behavior:'smooth'});
      ok('Saved locally. Total: '+getAll().length);
    }, { capture:true });

    // ===== triple-tap (.logo) to toggle #adminBar (NO long-press) =====
    (function(){
      if (!logo || !adminBar) return;
      logo.style.pointerEvents='auto';
      const REQUIRED_TAPS=3, WINDOW_MS=1200;
      let taps=0, first=0, tmr=null, lastTouch=0;
      const reset=()=>{ taps=0; first=0; if(tmr){clearTimeout(tmr); tmr=null;} };
      const toggle=()=>{ adminBar.style.display = (adminBar.style.display==='none'||!adminBar.style.display)?'flex':'none'; };
      function onTouchEnd(ev){
        ev.preventDefault(); ev.stopPropagation();
        lastTouch=Date.now(); const now=lastTouch;
        if (!first || (now-first)>WINDOW_MS){ first=now; taps=1; if(tmr)clearTimeout(tmr); tmr=setTimeout(reset,WINDOW_MS+100); }
        else { taps++; }
        if (taps>=REQUIRED_TAPS){ if(tmr)clearTimeout(tmr); reset(); toggle(); }
      }
      function onClick(ev){
        if (Date.now()-lastTouch<700) return; // ignore synthetic click after touch
        ev.preventDefault(); ev.stopPropagation();
        const now=Date.now();
        if (!first || (now-first)>WINDOW_MS){ first=now; taps=1; if(tmr)clearTimeout(tmr); tmr=setTimeout(reset,WINDOW_MS+100); }
        else { taps++; }
        if (taps>=REQUIRED_TAPS){ if(tmr)clearTimeout(tmr); reset(); toggle(); }
      }
      logo.addEventListener('touchend', onTouchEnd, { passive:false });
      logo.addEventListener('click',    onClick,    { passive:false });
    })();

    // ===== export buttons (manual) =====
    function downloadJSON(filename, obj){
      const blob=new Blob([JSON.stringify(obj,null,2)],{type:'application/json'});
      const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=filename;
      document.body.appendChild(a); a.click(); a.remove(); setTimeout(()=>URL.revokeObjectURL(url),500);
    }
    function toCSV(rows){
      if (!rows.length) return '';
      const headers=Array.from(new Set(rows.flatMap(r=>Object.keys(r))));
      const esc=v=>`"${String(v??'').replace(/"/g,'""')}"`;
      return [headers.join(',')].concat(rows.map(r=>headers.map(h=>esc(r[h])).join(','))).join('\n');
    }
    exportAllBtn?.addEventListener('click', ()=>{
      const entries=getAll(); if (!entries.length){ err('No saved forms to export.'); return; }
      const bundle={exported_at:new Date().toISOString(), count:entries.length, entries};
      const fn='wildpx_releases_'+new Date().toISOString().slice(0,10)+'_n'+entries.length+'.json';
      downloadJSON(fn,bundle); ok('Exported '+entries.length+' forms.');
    });
    exportClearBtn?.addEventListener('click', ()=>{
      const entries=getAll(); if (!entries.length){ err('Nothing to export.'); return; }
      if (!confirm('Export all forms and then clear them from this device?')) return;
      const bundle={exported_at:new Date().toISOString(), count:entries.length, entries};
      const fn='wildpx_releases_'+new Date().toISOString().slice(0,10)+'_n'+entries.length+'.json';
      downloadJSON(fn,bundle); localStorage.removeItem(KEY); updateSavedCount(); ok('Exported and cleared.');
    });
    exportCsvBtn?.addEventListener('click', ()=>{
      const entries=getAll(); if (!entries.length){ err('No saved forms to export.'); return; }
      const csv=toCSV(entries); const blob=new Blob([csv],{type:'text/csv'});
      const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='wildpx_releases_'+new Date().toISOString().slice(0,10)+'.csv';
      document.body.appendChild(a); a.click(); a.remove(); setTimeout(()=>URL.revokeObjectURL(url),500); ok('Exported CSV.');
    });
    printPdfBtn?.addEventListener('click', ()=>{ window.print(); });
  });

<!-- SignaturePad library (required for drawing to work) -->
<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>

<!-- Load your fixed app script -->
<script src="./app-v1.js?v=3"></script>
</body>
</html>













