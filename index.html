<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>WildPx Model Release</title>
<style>
  body{margin:0;font-family:Segoe UI,Tahoma,Arial,sans-serif;color:#fff;background:url('BackgroundImage.png') center/cover fixed no-repeat;}
  body::before{content:"";position:fixed;inset:0;background:rgba(0,100,0,.8);z-index:0}
  .overlay{position:relative;z-index:1;background:rgba(0,0,0,.65);max-width:600px;margin:40px auto;padding:20px;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,.4)}
  label,select,input,textarea,button{display:block;width:100%;margin-bottom:12px;font-size:1rem}
  input,select,textarea{padding:8px;border:none;border-radius:4px;box-sizing:border-box}
  button{background:#5cb85c;color:#fff;font-weight:700;padding:10px;border:none;border-radius:6px;cursor:pointer}
  button:hover{background:#4cae4c}
  .logo{display:block;margin:0 auto 20px;max-width:200px}
  canvas{background:#fff;border:1px solid #ccc;border-radius:4px;display:block;width:100%;height:150px;margin-bottom:10px;touch-action:none}
  #banner{display:none;position:fixed;left:16px;right:16px;top:12px;z-index:9999;background:rgba(34,197,94,.95);color:#fff;padding:12px;border-radius:8px;text-align:center;font-weight:700}
  #savedCount{font-size:.9rem;opacity:.9;margin-bottom:10px}
  .row{display:flex;gap:12px}
  .row > button{flex:1}
</style>
</head>
<body>
  <div id="banner" role="status" aria-live="polite"></div>

  <div class="overlay">
    <img src="WILDPX-01-5-.png" alt="WildPx Logo" class="logo" />
    <h1>Model & Photo Release Form</h1>

    <div id="savedCount">Saved on this device: <b>0</b></div>

    <form id="releaseForm" novalidate>
      <label>Full Name:
        <input type="text" name="fullName" required />
      </label>
      <label>Address Line 1:
        <input type="text" name="address1" />
      </label>
      <label>Address Line 2:
        <input type="text" name="address2" />
      </label>
      <label>City:
        <input type="text" name="city" />
      </label>
      <label>State:
        <input type="text" name="state" />
      </label>
      <label>Zip Code:
        <input type="text" name="zip" />
      </label>
      <label>Phone:
        <input type="text" name="phone" />
      </label>
      <label>Email:
        <input type="email" name="email" />
      </label>

      <label>Are you at least 18 years of age?
        <select id="ageCheck" name="ageCheck" required>
          <option value="">Select</option>
          <option value="yes">Yes</option>
          <option value="no">No</option>
        </select>
      </label>

      <div id="childrenSection" style="display:none">
        <h3>Additional Children (if any)</h3>
        <label>Names and ages:
          <textarea name="additionalChildren" rows="3" placeholder="Example: Jane (7), Sam (5)"></textarea>
        </label>
      </div>

      <div id="guardianSection" style="display:none">
        <h3>Parent/Guardian Info</h3>
        <label>Guardian Name:
          <input type="text" name="guardianName" />
        </label>
        <label>Relationship to Participant:
          <input type="text" name="guardianRelationship" />
        </label>
        <label>Guardian Signature:</label>
        <canvas id="guardianSignatureCanvas"></canvas>
        <button type="button" onclick="clearGuardianSig()">Clear Guardian Signature</button>
        <input type="hidden" name="guardianSignature" id="guardianSignatureData" />
      </div>

      <label>
        Please take or upload a photo of yourself.
        <input type="file" name="headshot" accept="image/*" capture="user" />
      </label>

      <p><strong>Photo Release & Copyright Agreement</strong></p>
      <ul>
        <li>I do not own any rights to the images.</li>
        <li>All rights remain with WildPx LLC.</li>
        <li>No compensation unless agreed in writing.</li>
        <li>Images may be edited or modified.</li>
        <li>I waive right to review final use.</li>
      </ul>

      <label>Model Signature:</label>
      <canvas id="modelSignatureCanvas"></canvas>
      <button type="button" onclick="clearModelSig()">Clear Model Signature</button>
      <input type="hidden" name="modelSignature" id="modelSignatureData" />

      <label>Date:
        <input type="date" name="signatureDate" required />
      </label>

      <div class="row">
        <button type="submit">Submit</button>
        <button type="button" id="exportBtn" style="background:#2563eb">Export</button>
        <button type="button" id="clearBtn"  style="background:#b91c1c">Clear</button>
      </div>
    </form>
  </div>

  <!-- SignaturePad -->
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.5/dist/signature_pad.umd.min.js"></script>

  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('releaseForm');
    const banner = document.getElementById('banner');
    const savedCountEl = document.querySelector('#savedCount b');

    const ageSelect = document.getElementById('ageCheck');
    const guardianSection = document.getElementById('guardianSection');
    const childrenSection = document.getElementById('childrenSection');

    const modelCanvas = document.getElementById('modelSignatureCanvas');
    const guardianCanvas = document.getElementById('guardianSignatureCanvas');

    const modelSigField = document.getElementById('modelSignatureData');
    const guardianSigField = document.getElementById('guardianSignatureData');

    const exportBtn = document.getElementById('exportBtn');
    const clearBtn  = document.getElementById('clearBtn');

    const signatureDateInput = form.querySelector('input[name="signatureDate"]');

    function showBanner(msg) {
      banner.textContent = msg || '‚úÖ Saved';
      banner.style.display = 'block';
      banner.style.opacity = '1';
      setTimeout(() => { banner.style.display = 'none'; }, 5000);
    }

    function setTodayIfBlank() {
      if (!signatureDateInput.value) signatureDateInput.value = new Date().toISOString().slice(0,10);
    }

    function resizeCanvas(canvas, pad) {
      const ratio = Math.max(window.devicePixelRatio || 1, 1);
      const rect = canvas.getBoundingClientRect();
      if (!rect.width) return;
      canvas.width  = Math.floor(rect.width * ratio);
      canvas.height = Math.floor(150 * ratio);
      canvas.getContext('2d').scale(ratio, ratio);
      if (pad && typeof pad.clear === 'function') pad.clear();
    }

    // Signature pads
    let modelPad = null;
    let guardianPad = null;

    function initModelPad() {
      if (!window.SignaturePad) return;
      modelPad = new window.SignaturePad(modelCanvas, { penColor: '#000' });
      requestAnimationFrame(() => resizeCanvas(modelCanvas, modelPad));
    }
    function initGuardianPad() {
      if (!window.SignaturePad) return;
      if (!guardianPad) guardianPad = new window.SignaturePad(guardianCanvas, { penColor: '#000' });
      requestAnimationFrame(() => resizeCanvas(guardianCanvas, guardianPad));
    }

    window.clearModelSig = () => { if (modelPad) modelPad.clear(); };
    window.clearGuardianSig = () => { if (guardianPad) guardianPad.clear(); };

    initModelPad();

    window.addEventListener('resize', () => {
      if (modelPad) requestAnimationFrame(() => resizeCanvas(modelCanvas, modelPad));
      if (guardianPad && guardianSection.style.display !== 'none') {
        requestAnimationFrame(() => resizeCanvas(guardianCanvas, guardianPad));
      }
    });

    // Age toggle
    function updateMinorUI() {
      const isMinor = String(ageSelect.value || '').toLowerCase() === 'no';
      guardianSection.style.display = isMinor ? 'block' : 'none';
      childrenSection.style.display = isMinor ? 'block' : 'none';

      const gName = form.querySelector('input[name="guardianName"]');
      const gRel  = form.querySelector('input[name="guardianRelationship"]');
      if (gName) gName.required = isMinor;
      if (gRel)  gRel.required  = isMinor;

      if (isMinor) initGuardianPad();
    }
    ageSelect.addEventListener('change', updateMinorUI);
    ageSelect.addEventListener('input', updateMinorUI);
    updateMinorUI();

    // Saved count
    function updateSavedCount() {
      const total = JSON.parse(localStorage.getItem('formEntries') || '[]').length;
      savedCountEl.textContent = total;
    }
    updateSavedCount();

    // Submit (local save only)
    form.addEventListener('submit', (e) => {
      e.preventDefault();

      setTodayIfBlank();

      modelSigField.value = (modelPad && !modelPad.isEmpty()) ? modelPad.toDataURL('image/jpeg', 0.85) : '';
      const needGuardian = guardianSection.style.display !== 'none';
      guardianSigField.value =
        (needGuardian && guardianPad && !guardianPad.isEmpty())
          ? guardianPad.toDataURL('image/jpeg', 0.85)
          : '';

      const data = Object.fromEntries(new FormData(form).entries());
      data.timestamp = new Date().toISOString();

      try {
        const arr = JSON.parse(localStorage.getItem('formEntries') || '[]');
        arr.push(data);
        localStorage.setItem('formEntries', JSON.stringify(arr));
        updateSavedCount();
        showBanner('‚úÖ Saved locally. Total: ' + arr.length);
      } catch (err) {
        alert('‚ö†Ô∏è Could not save locally: ' + err.message);
        return;
      }

      form.reset();
      if (modelPad) modelPad.clear();
      if (guardianPad) guardianPad.clear();
      updateMinorUI();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }, { capture: true });

    // Export / Clear
    function downloadJSON(filename, text) {
      const blob = new Blob([text], { type:'application/json' });
      const url  = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = filename;
      document.body.appendChild(a); a.click(); a.remove();
      setTimeout(() => URL.revokeObjectURL(url), 500);
    }

    exportBtn.addEventListener('click', () => {
      const data = localStorage.getItem('formEntries') || '[]';
      const when = new Date().toISOString().slice(0,10);
      downloadJSON(`wildpx_releases_${when}.json`, data);
    });

    clearBtn.addEventListener('click', () => {
      if (confirm('Delete all locally saved forms on this device?')) {
        localStorage.removeItem('formEntries');
        updateSavedCount();
        showBanner('üóëÔ∏è Local forms cleared.');
      }
    });
  });
  </script>
</body>
</html>
